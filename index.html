```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbie: The Dream Design Project</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #E0218A 0%, #00AEEF 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        #game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            color: #E0218A;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        h2 {
            color: #00AEEF;
            margin: 20px 0 10px 0;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #FFE0F0 0%, #E0F7FF 100%);
            border-radius: 10px;
        }
        
        .stat {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #E0218A;
        }
        
        .stat-label {
            font-weight: bold;
            color: #E0218A;
            font-size: 0.9em;
        }
        
        .stat-value {
            font-size: 1.5em;
            color: #00AEEF;
            font-weight: bold;
        }
        
        .morale-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid #E0218A;
        }
        
        .morale-fill {
            height: 100%;
            background: linear-gradient(90deg, #E0218A 0%, #00AEEF 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .story-text {
            background: #f9f9f9;
            padding: 20px;
            border-left: 4px solid #00AEEF;
            margin: 20px 0;
            line-height: 1.6;
            border-radius: 5px;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background: linear-gradient(135deg, #E0218A 0%, #00AEEF 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: left;
        }
        
        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(224, 33, 138, 0.4);
        }
        
        .choice-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .choice-stat {
            font-size: 0.85em;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #E0218A;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            color: #E0218A;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .result-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            animation: slideIn 0.5s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .result-success {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .result-fail {
            background: #f8d7da;
            border-color: #dc3545;
        }
        
        .result-critical {
            background: #d1ecf1;
            border-color: #00AEEF;
        }
        
        .hidden {
            display: none;
        }
        
        .npc-affinity {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
        
        .npc-name {
            font-weight: bold;
            color: #E0218A;
        }
        
        .npc-value {
            color: #00AEEF;
            font-weight: bold;
        }
        
        .dice-roll {
            text-align: center;
            font-size: 3em;
            color: #E0218A;
            margin: 20px 0;
            animation: rollDice 0.5s;
        }
        
        @keyframes rollDice {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }
        
        .ending-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .ending-title {
            font-size: 2em;
            color: #E0218A;
            margin-bottom: 20px;
        }
        
        .ending-text {
            font-size: 1.2em;
            line-height: 1.6;
            color: #666;
        }
        
        .restart-btn {
            background: #00AEEF;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 30px;
            font-weight: bold;
        }
        
        .restart-btn:hover {
            background: #E0218A;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>‚ú® Barbie: The Dream Design Project ‚ú®</h1>
        <p class="subtitle">Save the Malibu Community Center and make your dreams come true!</p>
        
        <div id="game-content"></div>
    </div>

    <script>
        const game = {
            player: {
                name: '',
                origin: '',
                stats: {
                    spark: 5,
                    chic: 5,
                    heart: 5,
                    hustle: 5
                },
                morale: 100,
                flags: {
                    scene1Success: false,
                    scene1Method: '',
                    befriendedRaquelle: false,
                    communityCenterFlooded: false,
                    hasHighChic: false
                }
            },
            npcs: {
                ken: 50,
                raquelle: 30,
                teresa: 50
            },
            difficulty: 'normal',
            difficultyThresholds: {
                easy: 8,
                normal: 12,
                hard: 15
            },
            currentScene: 'intro',
            projectScore: 0
        };

        function render(content) {
            document.getElementById('game-content').innerHTML = content;
        }

        function rollDice() {
            return Math.floor(Math.random() * 20) + 1;
        }

        function resolveAction(stat, isRisky = false) {
            const roll = rollDice();
            const statValue = game.player.stats[stat];
            const threshold = game.difficultyThresholds[game.difficulty];
            const adjustedThreshold = isRisky ? threshold + 3 : threshold;
            const total = roll + statValue;

            let result = {
                roll: roll,
                total: total,
                success: false,
                critical: false,
                statUsed: stat
            };

            if (roll === 20) {
                result.success = true;
                result.critical = true;
            } else if (roll === 1) {
                result.success = false;
                result.critical = true;
            } else if (total >= adjustedThreshold) {
                result.success = true;
            } else {
                result.success = false;
                if (game.difficulty === 'easy') {
                    result.partial = true;
                }
            }

            return result;
        }

        function updateStats(changes) {
            for (let stat in changes) {
                if (stat === 'morale') {
                    game.player.morale = Math.max(0, Math.min(100, game.player.morale + changes[stat]));
                } else if (game.player.stats.hasOwnProperty(stat)) {
                    game.player.stats[stat] = Math.max(0, Math.min(20, game.player.stats[stat] + changes[stat]));
                }
            }
            
            if (game.player.morale <= 0) {
                showEnding('burnout');
            }
        }

        function updateNPCAffinity(npc, change) {
            game.npcs[npc] = Math.max(0, Math.min(100, game.npcs[npc] + change));
        }

        function showStats() {
            return `
                <div class="morale-bar">
                    <div class="morale-fill" style="width: ${game.player.morale}%">
                        Morale: ${game.player.morale}
                    </div>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <div class="stat-label">‚ú® Spark (Creativity)</div>
                        <div class="stat-value">${game.player.stats.spark}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">üëó Chic (Style)</div>
                        <div class="stat-value">${game.player.stats.chic}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">üíñ Heart (Empathy)</div>
                        <div class="stat-value">${game.player.stats.heart}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">üíº Hustle (Ambition)</div>
                        <div class="stat-value">${game.player.stats.hustle}</div>
                    </div>
                </div>
                <div class="stats-container">
                    <div class="npc-affinity">
                        <span class="npc-name">Ken:</span>
                        <span class="npc-value">${game.npcs.ken}</span>
                    </div>
                    <div class="npc-affinity">
                        <span class="npc-name">Raquelle:</span>
                        <span class="npc-value">${game.npcs.raquelle}</span>
                    </div>
                    <div class="npc-affinity">
                        <span class="npc-name">Teresa:</span>
                        <span class="npc-value">${game.npcs.teresa}</span>
                    </div>
                </div>
            `;
        }

        function startGame() {
            render(`
                <h2>Welcome to Malibu Dream Bay!</h2>
                <div class="story-text">
                    <p>You're about to embark on an incredible journey to save the Historic Malibu Community Center! But first, let's get to know you better...</p>
                </div>
                
                <div class="input-group">
                    <label>What's your name?</label>
                    <input type="text" id="player-name" placeholder="Enter your fabulous name!">
                </div>
                
                <div class="input-group">
                    <label>Choose your difficulty:</label>
                    <select id="difficulty">
                        <option value="easy">Dreamer (Easy) - Forgiving and fun!</option>
                        <option value="normal" selected>Icon (Normal) - Balanced challenge!</option>
                        <option value="hard">Boss (Hard) - Only for the brave!</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>What's your background?</label>
                    <select id="origin">
                        <option value="">Choose your origin story...</option>
                        <option value="vet">The Vet - Caring and hardworking (+3 Heart, +1 Hustle)</option>
                        <option value="fashionista">The Fashionista - Stylish and creative (+3 Chic, +1 Spark)</option>
                        <option value="ceo">The CEO - Ambitious and sophisticated (+3 Hustle, +1 Chic)</option>
                    </select>
                </div>
                
                <button class="choice-btn" onclick="createCharacter()">Start Your Dream Journey! ‚ú®</button>
            `);
        }

        function createCharacter() {
            const name = document.getElementById('player-name').value.trim();
            const difficulty = document.getElementById('difficulty').value;
            const origin = document.getElementById('origin').value;
            
            if (!name) {
                alert('Please enter your name!');
                return;
            }
            
            if (!origin) {
                alert('Please choose your origin story!');
                return;
            }
            
            game.player.name = name;
            game.difficulty = difficulty;
            game.player.origin = origin;
            
            switch(origin) {
                case 'vet':
                    game.player.stats.heart += 3;
                    game.player.stats.hustle += 1;
                    break;
                case 'fashionista':
                    game.player.stats.chic += 3;
                    game.player.stats.spark += 1;
                    break;
                case 'ceo':
                    game.player.stats.hustle += 3;
                    game.player.stats.chic += 1;
                    break;
            }
            
            showScene1();
        }

        function showScene1() {
            game.currentScene = 'scene1';
            render(`
                ${showStats()}
                <h2>Scene 1: The Crumbling Center</h2>
                <div class="story-text">
                    <p>You stand before the dilapidated Community Center. The building that once hosted countless dreams and gatherings now looks tired and forgotten. The roof is leaking, paint is peeling, and the Mayor has just given you an ultimatum:</p>
                    <p><strong>"${game.player.name}, you have 3 days to prove this place can be saved, or I'm selling it to the developers."</strong></p>
                    <p>The press is watching. The community is counting on you. What's your first move?</p>
                </div>
                
                <div class="choices">
                    <button class="choice-btn" onclick="scene1Choice('hustle')">
                        <div>üî® The Logical Fix</div>
                        <div class="choice-stat">Use HUSTLE to organize a volunteer crew</div>
                    </button>
                    <button class="choice-btn" onclick="scene1Choice('spark')">
                        <div>üí° The Artistic Spin</div>
                        <div class="choice-stat">Use SPARK to turn leaks into an art feature</div>
                    </button>
                    <button class="choice-btn" onclick="scene1Choice('chic')">
                        <div>‚ú® The Risky Gala (RISKY!)</div>
                        <div class="choice-stat">Use CHIC for a bold "Distressed Chic" runway show</div>
                    </button>
                </div>
            `);
        }

        function scene1Choice(stat) {
            const isRisky = stat === 'chic';
            const result = resolveAction(stat, isRisky);
            
            let resultText = '';
            let resultClass = '';
            
            if (stat === 'hustle') {
                if (result.success) {
                    resultText = `<h3>Success! üéâ</h3>
                        <p>The dice showed ${result.roll}! With your amazing hustle (${game.player.stats[stat]}), you organized the most efficient volunteer crew Malibu has ever seen!</p>
                        <p>The roof is patched, the community is energized, and you feel accomplished!</p>`;
                    resultClass = 'result-success';
                    updateStats({ hustle: 2, morale: 10 });
                    game.player.flags.scene1Success = true;
                    game.player.flags.scene1Method = 'hustle';
                    game.projectScore += 20;
                } else {
                    resultText = `<h3>Partial Success...</h3>
                        <p>The dice showed ${result.roll}. You tried hard, but the work was overwhelming.</p>
                        <p>The roof is patched, but you're exhausted from doing too much yourself.</p>`;
                    resultClass = 'result-fail';
                    updateStats({ morale: -10 });
                    game.projectScore += 5;
                }
            } else if (stat === 'spark') {
                if (result.success) {
                    resultText = `<h3>Creative Genius! ‚ú®</h3>
                        <p>The dice showed ${result.roll}! Your artistic vision transformed disaster into beauty!</p>
                        <p>You turned the leaking roof into a stunning indoor waterfall feature using recycled glass. It goes viral on social media! Even Raquelle is impressed!</p>`;
                    resultClass = 'result-success';
                    updateStats({ spark: 3, morale: 10 });
                    updateNPCAffinity('raquelle', 10);
                    updateNPCAffinity('teresa', 15);
                    game.player.flags.scene1Success = true;
                    game.player.flags.scene1Method = 'spark';
                    game.projectScore += 25;
                } else {
                    resultText = `<h3>Flooded Dreams... üíß</h3>
                        <p>The dice showed ${result.roll}. Your artistic vision didn't quite work out...</p>
                        <p>The waterfall feature flooded the entire lobby! You'll need to clean this up and rethink your approach.</p>`;
                    resultClass = 'result-fail';
                    updateStats({ chic: -2, morale: -15 });
                    game.player.flags.communityCenterFlooded = true;
                    game.projectScore -= 10;
                }
            } else if (stat === 'chic') {
                if (result.critical && result.roll === 20) {
                    resultText = `<h3>CRITICAL SUCCESS! üåüüëóüåü</h3>
                        <p>NAT 20! You rolled a perfect ${result.roll}!</p>
                        <p>The "Distressed Chic" runway show amidst the ruins becomes legendary! Investors are calling immediately! You've secured early funding and made headlines!</p>`;
                    resultClass = 'result-critical';
                    updateStats({ chic: 5, hustle: 5, morale: 20 });
                    game.player.flags.scene1Success = true;
                    game.player.flags.scene1Method = 'chic';
                    game.player.flags.hasHighChic = true;
                    game.projectScore += 50;
                } else if (result.success) {
                    resultText = `<h3>Bold Success! üëó</h3>
                        <p>The dice showed ${result.roll}! Your risky gamble paid off!</p>
                        <p>The runway show was stunning and got people talking about the center!</p>`;
                    resultClass = 'result-success';
                    updateStats({ chic: 3, morale: 15 });
                    game.player.flags.scene1Success = true;
                    game.player.flags.scene1Method = 'chic';
                    game.projectScore += 30;
                } else {
                    const moraleHit = game.difficulty === 'hard' ? -40 : -20;
                    const statHit = game.difficulty === 'hard' ? -5 : -2;
                    resultText = `<h3>Disaster! üò±</h3>
                        <p>The dice showed ${result.roll}. The risk was too great...</p>
                        <p>During the show, a piece of ceiling fell onto the runway! ${game.difficulty === 'hard' ? 'This is a major setback!' : 'The press is not impressed.'}</p>`;
                    resultClass = 'result-fail';
                    updateStats({ morale: moraleHit, chic: statHit, spark: statHit });
                    game.projectScore -= 20;
                }
            }
            
            // If morale hit 0 during updateStats, showEnding was called.
            // We must return here to prevent overwriting the ending screen.
            if (game.player.morale <= 0) return;

            render(`
                ${showStats()}
                <h2>Scene 1: The Crumbling Center</h2>
                <div class="dice-roll">üé≤ ${result.roll}</div>
                <div class="result-box ${resultClass}">
                    ${resultText}
                </div>
                <button class="choice-btn" onclick="showScene2()">Continue to Scene 2 ‚Üí</button>
            `);
        }

        function showScene2() {
            game.currentScene = 'scene2';
            render(`
                ${showStats()}
                <h2>Scene 2: The Sabotage</h2>
                <div class="story-text">
                    <p>Your Grand Opening is in 2 days! Everything is coming together beautifully... until you get a phone call.</p>
                    <p><strong>"I'm so sorry,"</strong> says the caterer, <strong>"but Raquelle has booked us for her party on the same night. We can't do both..."</strong></p>
                    <p>You have no food for your event! Raquelle's competitive streak is showing. How will you handle this?</p>
                </div>
                
                <div class="choices">
                    <button class="choice-btn" onclick="scene2Choice('heart')">
                        <div>üíñ Kill Them with Kindness</div>
                        <div class="choice-stat">Use HEART to ask Raquelle to combine parties</div>
                    </button>
                    <button class="choice-btn" onclick="scene2Choice('spark')">
                        <div>üå± DIY Buffet</div>
                        <div class="choice-stat">Use SPARK to cook from the community garden</div>
                    </button>
                    <button class="choice-btn" onclick="scene2Choice('hustle')">
                        <div>üöÅ The Risky Heist (RISKY!)</div>
                        <div class="choice-stat">Use HUSTLE to helicopter in pizza from New York</div>
                    </button>
                </div>
            `);
        }

        function scene2Choice(stat) {
            const isRisky = stat === 'hustle';
            const result = resolveAction(stat, isRisky);
            
            let resultText = '';
            let resultClass = '';
            
            if (stat === 'heart') {
                if (result.success) {
                    resultText = `<h3>Friendship Wins! üíñ</h3>
                        <p>The dice showed ${result.roll}! Your genuine kindness touched Raquelle's heart!</p>
                        <p>She agrees to combine the parties! It becomes the biggest social event of the season! Raquelle is now your ally!</p>`;
                    resultClass = 'result-success';
                    updateStats({ heart: 3, morale: 15 });
                    updateNPCAffinity('raquelle', 40);
                    game.player.flags.befriendedRaquelle = true;
                    game.projectScore += 30;
                } else {
                    resultText = `<h3>Rejected... üò¢</h3>
                        <p>The dice showed ${result.roll}. Raquelle wasn't ready to make peace.</p>
                        <p>She laughs at your proposal and says her party will be better. You've lost valuable time.</p>`;
                    resultClass = 'result-fail';
                    updateStats({ morale: -10 });
                    updateNPCAffinity('raquelle', -10);
                    game.projectScore += 5;
                }
            } else if (stat === 'spark') {
                if (result.success) {
                    resultText = `<h3>Rustic Charm! üå±</h3>
                        <p>The dice showed ${result.roll}! Your creative cooking is a hit!</p>
                        <p>The farm-to-table buffet using the community garden becomes a talking point! Ken especially loves your authentic approach!</p>`;
                    resultClass = 'result-success';
                    updateStats({ spark: 2, morale: 10 });
                    updateNPCAffinity('ken', 15);
                    updateNPCAffinity('teresa', 10);
                    game.projectScore += 20;
                } else {
                    resultText = `<h3>Food Scare! ü§¢</h3>
                        <p>The dice showed ${result.roll}. Your cooking didn't go as planned...</p>
                        <p>There's a minor food poisoning scare (nothing serious, but embarrassing). Your reputation takes a small hit.</p>`;
                    resultClass = 'result-fail';
                    updateStats({ hustle: -3, morale: -10 });
                    game.projectScore -= 10;
                }
            } else if (stat === 'hustle') {
                if (result.critical && result.roll === 20) {
                    resultText = `<h3>LEGENDARY MOMENT! üöÅüçï</h3>
                        <p>NATURAL 20! You rolled ${result.roll}!</p>
                        <p>The helicopter arrives with authentic New York pizza! It becomes the most talked-about moment in Malibu history! You've trending worldwide!</p>`;
                    resultClass = 'result-critical';
                    updateStats({ hustle: 5, morale: 20 });
                    game.projectScore += 40;
                } else if (result.success) {
                    resultText = `<h3>Audacious Success! üöÅ</h3>
                        <p>The dice showed ${result.roll}! Your bold plan worked!</p>
                        <p>The helicopter pizza delivery is a hit! People can't believe you pulled it off!</p>`;
                    resultClass = 'result-success';
                    updateStats({ hustle: 3, morale: 15 });
                    game.projectScore += 25;
                } else {
                    resultText = `<h3>Grounded! ‚õàÔ∏è</h3>
                        <p>The dice showed ${result.roll}. Weather conditions grounded the helicopter...</p>
                        <p>No pizza, no food at all! The party is awkward and people leave early. This is a major setback!</p>`;
                    resultClass = 'result-fail';
                    updateStats({ morale: -30, hustle: -3 });
                    game.projectScore -= 20;
                }
            }
            
            if (game.player.morale <= 0) return;

            render(`
                ${showStats()}
                <h2>Scene 2: The Sabotage</h2>
                <div class="dice-roll">üé≤ ${result.roll}</div>
                <div class="result-box ${resultClass}">
                    ${resultText}
                </div>
                <button class="choice-btn" onclick="showScene3()">Continue to the Grand Finale ‚Üí</button>
            `);
        }

        function showScene3() {
            game.currentScene = 'scene3';
            
            const scene1Requirement = game.player.flags.scene1Success;
            const chicRequirement = game.player.stats.chic >= 15;
            
            render(`
                ${showStats()}
                <h2>Scene 3: The Grand Finale - The Runway!</h2>
                <div class="story-text">
                    <p>Tonight is the night! The Grand Opening of the reimagined Malibu Community Center!</p>
                    <p>The Mayor is in the front row. Investors are watching. The entire community has gathered. You need to present your vision for the new center in the most impactful way possible.</p>
                    <p>This is your moment to shine, ${game.player.name}! How will you close the show?</p>
                </div>
                
                <div class="choices">
                    <button class="choice-btn" onclick="scene3Choice('heart')" ${!scene1Requirement ? 'disabled' : ''}>
                        <div>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ The Community Speech</div>
                        <div class="choice-stat">Use HEART - Walk with the children of Malibu</div>
                        ${!scene1Requirement ? '<div class="choice-stat">‚ö†Ô∏è Requires success in Scene 1</div>' : ''}
                    </button>
                    <button class="choice-btn" onclick="scene3Choice('chic')" ${!chicRequirement ? 'disabled' : ''}>
                        <div>üëó The High Fashion Show</div>
                        <div class="choice-stat">Use CHIC - Wear your self-designed "Dream Dress"</div>
                        ${!chicRequirement ? '<div class="choice-stat">‚ö†Ô∏è Requires Chic 15+</div>' : ''}
                    </button>
                    <button class="choice-btn" onclick="scene3Choice('spark')">
                        <div>üåü The Holographic Projection (RISKY!)</div>
                        <div class="choice-stat">Use SPARK - Attempt never-before-seen tech</div>
                    </button>
                </div>
            `);
        }

        function scene3Choice(stat) {
            const isRisky = stat === 'spark';
            const result = resolveAction(stat, isRisky);
            
            let resultText = '';
            let resultClass = '';
            
            if (stat === 'heart') {
                if (result.success) {
                    resultText = `<h3>Heartwarming Triumph! üíñ</h3>
                        <p>The dice showed ${result.roll}! Your emotional intelligence saved the day!</p>
                        <p>The children of Malibu walk the runway with you, each sharing what the community center means to them. There's not a dry eye in the house. The Mayor is moved to tears and immediately approves the project!</p>`;
                    resultClass = 'result-success';
                    updateStats({ heart: 4, morale: 20 });
                    game.projectScore += 40;
                } else {
                    resultText = `<h3>Touching but Mixed...</h3>
                        <p>The dice showed ${result.roll}. The moment was sweet but not quite perfect.</p>
                        <p>The children's presentation is adorable, but some technical issues diminish the impact.</p>`;
                    resultClass = 'result-fail';
                    updateStats({ morale: -5 });
                    game.projectScore += 15;
                }
            } else if (stat === 'chic') {
                if (result.critical && result.roll === 20) {
                    resultText = `<h3>FASHION ICON MOMENT! üëó‚ú®</h3>
                        <p>PERFECT 20! You rolled ${result.roll}!</p>
                        <p>Your "Dream Dress" is breathtaking! It perfectly embodies everything the community center represents - creativity, hope, and transformation! Fashion magazines are already calling! The Mayor not only approves the project but increases the budget!</p>`;
                    resultClass = 'result-critical';
                    updateStats({ chic: 5, morale: 25 });
                    game.projectScore += 60;
                } else if (result.success) {
                    resultText = `<h3>Stunning Success! üëó</h3>
                        <p>The dice showed ${result.roll}! Your fashion prowess shines!</p>
                        <p>The "Dream Dress" is gorgeous and represents your vision perfectly! The crowd loves it!</p>`;
                    resultClass = 'result-success';
                    updateStats({ chic: 3, morale: 15 });
                    game.projectScore += 35;
                } else {
                    resultText = `<h3>Wardrobe Malfunction! üò¨</h3>
                        <p>The dice showed ${result.roll}. Fashion can be unpredictable...</p>
                        <p>A strap breaks during the walk! You handle it with grace, but it's not the triumphant moment you hoped for.</p>`;
                    resultClass = 'result-fail';
                    updateStats({ morale: -10 });
                    game.projectScore += 10;
                }
            } else if (stat === 'spark') {
                if (result.critical && result.roll === 20) {
                    resultText = `<h3>TECHNOLOGICAL MIRACLE! üåü‚ú®üåü</h3>
                        <p>CRITICAL SUCCESS! Natural 20!</p>
                        <p>The holographic projection is FLAWLESS! You've created a fully immersive 3D experience showing the past, present, and future of the community center! People think they're in a dream! Tech companies are offering partnerships! This is revolutionary!</p>`;
                    resultClass = 'result-critical';
                    updateStats({ spark: 6, morale: 30 });
                    updateNPCAffinity('teresa', 30);
                    game.projectScore += 70;
                } else if (result.success) {
                    resultText = `<h3>Innovation Triumph! üåü</h3>
                        <p>The dice showed ${result.roll}! Your creativity knows no bounds!</p>
                        <p>The holographic tech works! It's impressive and futuristic, showing everyone what's possible!</p>`;
                    resultClass = 'result-success';
                    updateStats({ spark: 4, morale: 20 });
                    updateNPCAffinity('teresa', 20);
                    game.projectScore += 45;
                } else {
                    resultText = `<h3>Technical Difficulties! ‚ö†Ô∏è</h3>
                        <p>The dice showed ${result.roll}. The tech wasn't quite ready...</p>
                        <p>The holographic projection glitches and shows distorted images. It's embarrassing, but you recover by giving an impromptu speech about how even setbacks are part of the creative process.</p>`;
                    resultClass = 'result-fail';
                    updateStats({ morale: -15, spark: -2 });
                    game.projectScore += 5;
                }
            }
            
            if (game.player.morale <= 0) return;

            render(`
                ${showStats()}
                <h2>Scene 3: The Grand Finale</h2>
                <div class="dice-roll">üé≤ ${result.roll}</div>
                <div class="result-box ${resultClass}">
                    ${resultText}
                </div>
                <button class="choice-btn" onclick="showEnding()">See Your Ending! ‚ú®</button>
            `);
        }

        function showEnding(forceType = null) {
            let endingTitle = '';
            let endingText = '';
            let endingClass = 'result-success';
            
            if (forceType === 'burnout' || game.player.morale <= 0) {
                endingTitle = 'üò¥ The Burnout Ending üò¥';
                endingText = `
                    <p>You gave everything to this project, ${game.player.name}, but you pushed yourself too hard.</p>
                    <p>The community center project is postponed while you take a much-needed vacation to recharge. Ken books you a spa retreat in the Malibu hills.</p>
                    <p><strong>"Even icons need to rest,"</strong> he reminds you.</p>
                    <p>Sometimes the dream requires us to take care of ourselves first. You'll come back stronger! üíñ</p>
                `;
                endingClass = 'result-fail';
            } else if (game.player.flags.befriendedRaquelle && game.npcs.raquelle >= 80) {
                endingTitle = 'üëØ‚Äç‚ôÄÔ∏è The Best Friends Forever Ending! üëØ‚Äç‚ôÄÔ∏è';
                endingText = `
                    <p>Incredible, ${game.player.name}! Not only did you save the community center, but you turned your rival into your best friend!</p>
                    <p>Raquelle approaches you after the finale: <strong>"I've been so impressed by your vision. What do you say we go into business together?"</strong></p>
                    <p>You and Raquelle launch "Dream & Design," a creative consultancy that transforms communities across the country! The Malibu Community Center becomes your flagship success story!</p>
                    <p><strong>Project Score: ${game.projectScore}</strong></p>
                    <p>You've proven that collaboration beats competition every time! üíï‚ú®</p>
                `;
                endingClass = 'result-critical';
            } else if (game.projectScore >= 100) {
                endingTitle = 'üåü The DREAM ICON Ending! üåü';
                endingText = `
                    <p>PHENOMENAL, ${game.player.name}! You didn't just save the community center - you revolutionized it!</p>
                    <p>The Mayor cuts the ribbon personally and announces: <strong>"This is the future of community spaces! We're creating a fund to replicate this model across the state!"</strong></p>
                    <p>Your innovation, style, heart, and hustle have created something truly special. The center becomes a landmark destination, featured in magazines and architectural tours!</p>
                    <p><strong>Final Project Score: ${game.projectScore}</strong></p>
                    <p>You're not just an icon - you're a legend! Dream big, achieve bigger! üíñ‚ú®üåü</p>
                `;
                endingClass = 'result-critical';
            } else if (game.projectScore >= 60) {
                endingTitle = '‚ú® The Success Story Ending! ‚ú®';
                endingText = `
                    <p>Congratulations, ${game.player.name}! You saved the Malibu Community Center!</p>
                    <p>The Mayor approves the project, and the community celebrates your achievement! The center opens to huge crowds and becomes a beloved neighborhood hub!</p>
                    <p><strong>Final Project Score: ${game.projectScore}</strong></p>
                    <p>You've proven that with creativity, style, empathy, and hard work, dreams really do come true! The center will serve the community for generations to come! üíñ</p>
                `;
                endingClass = 'result-success';
            } else {
                endingTitle = 'üå§Ô∏è The Learning Experience Ending üå§Ô∏è';
                endingText = `
                    <p>You tried your best, ${game.player.name}, and that takes courage!</p>
                    <p>The community center project didn't go exactly as planned, but the Mayor was impressed by your dedication. She gives you another chance with a smaller pilot program.</p>
                    <p><strong>Final Project Score: ${game.projectScore}</strong></p>
                    <p>You've learned valuable lessons about creativity, teamwork, and resilience. Sometimes the journey is more important than the destination! Ken, Teresa, and even Raquelle offer to help with the next phase. üíï</p>
                    <p><em>"Every setback is a setup for a comeback!"</em></p>
                `;
                endingClass = 'result-fail';
            }
            
            render(`
                <div class="ending-screen">
                    <div class="ending-title">${endingTitle}</div>
                    <div class="ending-text">${endingText}</div>
                    <div class="stats-container" style="margin-top: 30px;">
                        <h3 style="grid-column: 1 / -1; text-align: center; color: #E0218A;">Final Stats</h3>
                        <div class="stat">
                            <div class="stat-label">‚ú® Spark</div>
                            <div class="stat-value">${game.player.stats.spark}</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">üëó Chic</div>
                            <div class="stat-value">${game.player.stats.chic}</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">üíñ Heart</div>
                            <div class="stat-value">${game.player.stats.heart}</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">üíº Hustle</div>
                            <div class="stat-value">${game.player.stats.hustle}</div>
                        </div>
                    </div>
                    <button class="restart-btn" onclick="location.reload()">Play Again! üíï</button>
                </div>
            `);
        }

        // Start the game
        startGame();
    </script>
</body>
</html>
```