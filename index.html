<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ali Mario and the Forty Koopas</title>
    <style>
        :root {
            --sand: #edc9af;
            --gold: #ffd700;
            --mario-red: #e52521;
            --luigi-green: #43b047;
            --dark-desert: #2c1e16;
            --text-color: #f4e4bc;
        }

        body {
            background-color: var(--dark-desert);
            background-image: radial-gradient(circle, #3e2b1f 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-color);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #game-container {
            width: 90%;
            max-width: 700px;
            background: rgba(44, 30, 22, 0.95);
            border: 4px solid var(--sand);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
        }

        header {
            text-align: center;
            border-bottom: 2px solid var(--gold);
            margin-bottom: 20px;
            padding-bottom: 10px;
        }

        h1 {
            color: var(--gold);
            text-shadow: 2px 2px #000;
            margin: 0;
            font-size: 1.5rem;
        }

        #stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            background: #1a110a;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-val {
            font-weight: bold;
            color: var(--gold);
        }

        #narrative {
            line-height: 1.6;
            margin-bottom: 20px;
            min-height: 150px;
            font-size: 1.1rem;
        }

        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            background: #3e2b1f;
            color: white;
            border: 2px solid var(--sand);
            padding: 12px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: 0.2s;
            border-radius: 5px;
        }

        button:hover:not(:disabled) {
            background: var(--sand);
            color: #000;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .risky {
            border-color: #ff4500;
        }

        .risky:hover {
            background: #ff4500;
            color: white;
        }

        #feedback {
            margin-top: 20px;
            font-style: italic;
            color: var(--gold);
            height: 40px;
            text-align: center;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<div id="game-container">
    <header>
        <h1 id="title-text">Ali Mario and the Forty Koopas</h1>
    </header>

    <div id="stats-bar" class="hidden">
        <div class="stat-item">PWR <span id="pwr-val" class="stat-val">10</span></div>
        <div class="stat-item">WIT <span id="wit-val" class="stat-val">10</span></div>
        <div class="stat-item">SPR <span id="spr-val" class="stat-val">10</span></div>
        <div class="stat-item">FOR <span id="for-val" class="stat-val">10</span></div>
    </div>

    <div id="narrative">
        Welcome, traveler. In the scorching dunes of Qas’r Mushroom, Ali Mario labors under the sun. His brother Cassim-Luigi dreams of gold, while the Forty Koopas shadow the kingdom. Choose your destiny.
    </div>

    <div id="choices-container">
        <!-- Buttons injected here -->
    </div>

    <div id="feedback"></div>
</div>

<script>
    const state = {
        difficulty: 'Normal',
        stats: { PWR: 10, WIT: 10, SPR: 10, FOR: 10 },
        cassimAlive: true,
        isGameOver: false,
        currentStep: 'intro'
    };

    const narrativeElement = document.getElementById('narrative');
    const choicesContainer = document.getElementById('choices-container');
    const statsBar = document.getElementById('stats-bar');
    const feedback = document.getElementById('feedback');

    function updateUI() {
        document.getElementById('pwr-val').innerText = state.stats.PWR;
        document.getElementById('wit-val').innerText = state.stats.WIT;
        document.getElementById('spr-val').innerText = state.stats.SPR;
        document.getElementById('for-val').innerText = state.stats.FOR;
    }

    function showFeedback(msg) {
        feedback.innerText = msg;
        setTimeout(() => { feedback.innerText = ''; }, 3000);
    }

    function startGame(diff) {
        state.difficulty = diff;
        if (diff === 'Toad') {
            state.stats = { PWR: 15, WIT: 15, SPR: 15, FOR: 15 };
        } else if (diff === 'Hero') {
            state.stats = { PWR: 5, WIT: 5, SPR: 5, FOR: 5 };
        }
        
        statsBar.classList.remove('hidden');
        updateUI();
        goToScene('discovery');
    }

    function checkGameOver(isRiskyFail) {
        if (state.difficulty === 'Hero' && isRiskyFail) {
            state.isGameOver = true;
            gameOver("The Hero has fallen. A single risky failure was your end.");
            return true;
        }
        return false;
    }

    function gameOver(msg) {
        narrativeElement.innerHTML = `<span style="color:var(--mario-red)">GAME OVER</span><br><br>${msg}`;
        choicesContainer.innerHTML = `<button onclick="location.reload()">Try Again</button>`;
    }

    const scenes = {
        intro: {
            text: "Select your difficulty to begin the journey through the Sand-Kingdom.",
            choices: [
                { text: "Toad (Easy): +5 Stats, Safety Mushrooms available.", action: () => startGame('Toad') },
                { text: "Plumber (Normal): Standard stats.", action: () => startGame('Normal') },
                { text: "Hero (Hard): -5 Stats, One Risky failure = Game Over.", action: () => startGame('Hero') }
            ]
        },
        discovery: {
            text: "Ali Mario overhears the Forty Koopas opening a secret pipe-cave shaped like a giant stone Bowser. 'Open, Sesame-Pipe!' the Captain bellows. The jaw creaks open.",
            choices: [
                { 
                    text: "[Wit] Eavesdrop closely to learn the password. (Req: 10)", 
                    action: () => {
                        if (state.stats.WIT >= 10) {
                            state.stats.WIT += 5;
                            showFeedback("Success! You learned the password.");
                            goToScene('hoard');
                        } else {
                            state.stats.SPR -= 2;
                            showFeedback("Failure! You were nearly spotted. -2 SPR.");
                            if(state.difficulty === 'Toad') { state.stats.WIT += 2; showFeedback("Safety Mushroom found! +2 WIT"); }
                            goToScene('hoard');
                        }
                    }
                },
                { 
                    text: "[Power] Try to pry the stone jaw open manually. (Req: 15)", 
                    action: () => {
                        if (state.stats.PWR >= 15) {
                            state.stats.PWR += 5;
                            showFeedback("Success! Your strength is legendary.");
                            goToScene('hoard');
                        } else {
                            state.stats.PWR -= 5;
                            showFeedback("Failure! The jaw is too heavy. -5 PWR.");
                            if(state.difficulty === 'Toad') { state.stats.PWR += 2; showFeedback("Safety Mushroom found! +2 PWR"); }
                            goToScene('hoard');
                        }
                    }
                },
                { 
                    text: "[Risky] Rush the guards to steal a key.", 
                    className: "risky",
                    action: () => {
                        if (Math.random() > 0.5) {
                            state.stats.FOR += 10;
                            showFeedback("Huge Success! You stole a gold key!");
                            goToScene('hoard');
                        } else {
                            state.stats.SPR -= 10;
                            showFeedback("Captured! You were tossed into the dunes.");
                            if (!checkGameOver(true)) goToScene('hoard');
                        }
                    }
                }
            ]
        },
        hoard: {
            text: "Inside, Cassim-Luigi is frantically stuffing Fire-Rubies into his pockets. The cave begins to tremble! 'Ali, we'll be rich!' he yells. You see the Koopas returning on Lakitu clouds.",
            choices: [
                { 
                    text: "[Spirit] Convince Cassim to leave immediately. (Req: 12)", 
                    action: () => {
                        if (state.stats.SPR >= 12) {
                            state.stats.SPR += 5;
                            showFeedback("Success! You saved your brother.");
                            goToScene('siege');
                        } else {
                            state.stats.FOR -= 5;
                            state.cassimAlive = false;
                            showFeedback("Failure! Cassim refused to move. He's trapped! -5 FOR.");
                            goToScene('siege');
                        }
                    }
                },
                { 
                    text: "[Fortune] Grab a Fire Flower power-up for protection. (Req: 12)", 
                    action: () => {
                        if (state.stats.FOR >= 12) {
                            state.stats.PWR += 5;
                            showFeedback("Success! You found a Rare Flower!");
                            goToScene('siege');
                        } else {
                            state.stats.PWR -= 3;
                            showFeedback("Failure! It was a Poison Mushroom! -3 PWR.");
                            goToScene('siege');
                        }
                    }
                },
                { 
                    text: "[Risky] Stay to loot the 'Golden Shell.'", 
                    className: "risky",
                    action: () => {
                        if (Math.random() > 0.5) {
                            state.stats.FOR += 20;
                            showFeedback("Fortune! You grabbed the Golden Shell!");
                            goToScene('siege');
                        } else {
                            state.cassimAlive = false;
                            showFeedback("The exit sealed! Cassim is lost to the cave.");
                            if (!checkGameOver(true)) goToScene('siege');
                        }
                    }
                }
            ]
        },
        siege: {
            text: "The Captain of the Forty Koopas arrives at your oasis house disguised as an oil merchant. Morgi-Peach whispers, 'He has hidden Koopas in those jars!'",
            choices: [
                { 
                    text: "[Wit] Inspect the oil jars for hidden Koopas. (Req: 15)", 
                    action: () => {
                        if (state.stats.WIT >= 15) {
                            state.stats.WIT += 10;
                            showFeedback("Genius! You trapped them all inside.");
                            calculateEnding();
                        } else {
                            state.stats.PWR -= 5;
                            showFeedback("Ambushed! They were ready for you. -5 PWR.");
                            calculateEnding();
                        }
                    }
                },
                { 
                    text: "[Spirit] Challenge the 'Merchant' to riddles. (Req: 15)", 
                    action: () => {
                        if (state.stats.SPR >= 15) {
                            state.stats.SPR += 10;
                            showFeedback("Success! He leaves in shame.");
                            calculateEnding();
                        } else {
                            showFeedback("He marks your door for death!");
                            state.stats.FOR -= 10;
                            calculateEnding();
                        }
                    }
                },
                { 
                    text: "[Risky] Attempt to Ground Pound the merchant.", 
                    className: "risky",
                    action: () => {
                        if (Math.random() > 0.5) {
                            state.stats.PWR += 10;
                            showFeedback("Victory! You crushed the Captain!");
                            calculateEnding();
                        } else {
                            state.stats.FOR -= 10;
                            showFeedback("Failure! Your house is on fire!");
                            if (!checkGameOver(true)) calculateEnding();
                        }
                    }
                }
            ]
        }
    };

    function goToScene(sceneKey) {
        updateUI();
        const scene = scenes[sceneKey];
        narrativeElement.innerText = scene.text;
        choicesContainer.innerHTML = '';
        
        scene.choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.innerText = choice.text;
            if (choice.className) btn.classList.add(choice.className);
            btn.onclick = choice.action;
            choicesContainer.appendChild(btn);
        });
    }

    function calculateEnding() {
        updateUI();
        let title = "";
        let desc = "";

        if (state.stats.WIT >= 25 || state.stats.SPR >= 25) {
            title = "The Wise Sultan Mario";
            desc = "You defeated the Koopas with your mind and heart. Qas’r Mushroom flourishes under your rule with Morgi-Peach as your advisor.";
        } else if (state.stats.FOR >= 30) {
            title = "The Wealthy Exile";
            desc = "You saved the gold but lost your village's respect. You live in a palace of sand, lonely but rich.";
        } else if (state.cassimAlive && state.stats.PWR >= 20) {
            title = "The True Brother";
            desc = "You saved Cassim-Luigi and fought off the hoard. You are the legendary warrior of the dunes.";
        } else {
            title = "The Fallen Hero";
            desc = "You survived, but the village is in ruins and Cassim is gone. You wander the desert, searching for another pipe.";
        }

        narrativeElement.innerHTML = `<h2 style="color:var(--gold)">ENDING: ${title}</h2>${desc}`;
        choicesContainer.innerHTML = `<button onclick="location.reload()">New Journey</button>`;
    }

    // Initialize
    (function() {
        const intro = scenes.intro;
        choicesContainer.innerHTML = '';
        intro.choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.innerText = choice.text;
            btn.onclick = choice.action;
            choicesContainer.appendChild(btn);
        });
    })();

</script>

</body>
</html>