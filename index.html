<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Aurora Protocol</title>
    <style>
        :root {
            --bg-color: #050a10;
            --terminal-bg: rgba(10, 20, 30, 0.85);
            --primary-color: #00f2ff;
            --secondary-color: #00ff9d;
            --alert-color: #ff3333;
            --text-color: #e0f7fa;
            --font-main: 'Courier New', Courier, monospace;
            --glass-border: 1px solid rgba(0, 242, 255, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at 50% -20%, #1a2a40, #050a10 80%);
        }

        /* Aurora Effect */
        .aurora-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 40%, rgba(0, 255, 157, 0.1) 50%, rgba(0, 242, 255, 0.1) 60%, transparent 70%);
            filter: blur(40px);
            animation: aurora-move 15s infinite alternate linear;
            z-index: -1;
            pointer-events: none;
        }

        @keyframes aurora-move {
            0% { transform: translateX(-10%) skewX(-10deg); opacity: 0.5; }
            100% { transform: translateX(10%) skewX(10deg); opacity: 0.8; }
        }

        /* Scanline Overlay */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 100;
        }

        /* Main Interface Container */
        .interface-container {
            width: 95%;
            max-width: 1000px;
            height: 90vh;
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 10px;
            background: var(--terminal-bg);
            border: var(--glass-border);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.1);
            border-radius: 5px;
            padding: 15px;
            position: relative;
        }

        /* Header / Stats Bar */
        .hud-header {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 15px;
            padding-bottom: 10px;
            border-bottom: var(--glass-border);
            align-items: center;
        }

        .stats-panel {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
        }

        .stat-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--secondary-color);
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.2em;
        }

        .warmth-container {
            width: 100%;
        }

        .warmth-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            margin-bottom: 2px;
            color: var(--alert-color);
        }

        .warmth-bar-bg {
            width: 100%;
            height: 10px;
            background: #222;
            border: 1px solid #444;
        }

        .warmth-bar-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #ff3333, #ff9933, #ffffcc);
            transition: width 0.5s ease;
        }

        .system-status {
            text-align: right;
            font-size: 0.8em;
            color: var(--primary-color);
            text-transform: uppercase;
        }

        /* Chat Area */
        .game-log {
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(0, 0, 0, 0.3);
            font-size: 0.95em;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #111;
        }

        .game-log::-webkit-scrollbar {
            width: 8px;
        }
        .game-log::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
        }

        .message {
            max-width: 90%;
            padding: 10px;
            border-radius: 4px;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.gm {
            align-self: flex-start;
            color: #d1d5db;
            border-left: 3px solid var(--primary-color);
            background: rgba(0, 242, 255, 0.05);
        }

        .message.player {
            align-self: flex-end;
            color: #fff;
            border-right: 3px solid var(--secondary-color);
            background: rgba(0, 255, 157, 0.05);
            text-align: right;
        }

        .message.system {
            align-self: center;
            color: var(--alert-color);
            font-style: italic;
            border: 1px dashed var(--alert-color);
            font-size: 0.85em;
            width: 100%;
            text-align: center;
        }

        .message strong {
            color: var(--primary-color);
        }

        /* Input Area */
        .input-area {
            display: flex;
            gap: 10px;
            padding-top: 10px;
            border-top: var(--glass-border);
        }

        input[type="text"] {
            flex-grow: 1;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            color: var(--secondary-color);
            padding: 12px;
            font-family: var(--font-main);
            font-size: 1em;
            outline: none;
        }

        input[type="text"]:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.2);
        }

        button.send-btn {
            padding: 0 25px;
            background: var(--primary-color);
            color: #000;
            border: none;
            font-family: var(--font-main);
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        button.send-btn:hover {
            background: #fff;
            box-shadow: 0 0 15px var(--primary-color);
        }

        /* Start Overlay */
        #start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 10, 16, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            text-align: center;
        }

        #start-overlay h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--primary-color);
            font-size: 2.5em;
        }

        .init-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            background: transparent;
            color: var(--secondary-color);
            border: 2px solid var(--secondary-color);
            font-family: var(--font-main);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: 0.3s;
        }

        .init-btn:hover {
            background: var(--secondary-color);
            color: #000;
            box-shadow: 0 0 20px var(--secondary-color);
        }

        /* Markdown-like formatting helper */
        .gm-content h3 { color: var(--secondary-color); margin: 10px 0; }
        .gm-content ul { padding-left: 20px; margin: 10px 0; }
        .gm-content li { margin-bottom: 5px; }

    </style>
</head>
<body>

    <div class="aurora-bg"></div>
    <div class="scanlines"></div>

    <div class="interface-container">
        <!-- Overlay for initialization -->
        <div id="start-overlay">
            <h1>THE AURORA PROTOCOL</h1>
            <p style="margin-bottom: 30px; color: #aaa;">Secure Channel Required</p>
            <button class="init-btn" onclick="initGame()">Initialize Uplink</button>
        </div>

        <!-- Heads Up Display -->
        <div class="hud-header">
            <div class="stats-panel">
                <div class="stat-box">
                    <span>GRIT</span>
                    <span id="grit-val" class="stat-value">?</span>
                </div>
                <div class="stat-box">
                    <span>WITS</span>
                    <span id="wits-val" class="stat-value">?</span>
                </div>
                <div class="stat-box">
                    <span>SPIRIT</span>
                    <span id="spirit-val" class="stat-value">?</span>
                </div>
            </div>

            <div class="warmth-container">
                <div class="warmth-label">
                    <span>CORE TEMPERATURE</span>
                    <span id="warmth-text">100%</span>
                </div>
                <div class="warmth-bar-bg">
                    <div id="warmth-fill" class="warmth-bar-fill" style="width: 100%;"></div>
                </div>
            </div>

            <div class="system-status">
                <div>Loc: North Pole</div>
                <div id="clock">00:00:00</div>
            </div>
        </div>

        <!-- Chat Area -->
        <div id="chat-box" class="game-log">
            <!-- Messages will appear here -->
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Enter action or dialogue..." autocomplete="off">
            <button class="send-btn" onclick="sendMessage()">Transmit</button>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            stats: {
                grit: 0,
                wits: 0,
                spirit: 0,
                warmth: 100
            },
            theme: "The Aurora Protocol"
        };

        // Trigger Webhook Function
        async function startGameGeneration(theme) {
            try {
                addMessage('system', 'Connecting to Game Master Node...');
                
                // Note: If this URL is invalid or CORS protected, it will throw.
                // We handle this gracefully in the catch block.
                await fetch('https://n8n.srv931177.hstgr.cloud/webhook-test/gamemaster', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ theme: theme })
                });
                
                alert('Generation started! Reload in a minute.');
                addMessage('system', 'Uplink established. Signal verified.');
            } catch (error) {
                console.warn('Webhook Error:', error);
                addMessage('system', 'Connection warning: Using local cache. (Simulation Mode Active)');
            }
        }

        // Initialization Logic
        function initGame() {
            document.getElementById('start-overlay').style.display = 'none';
            
            // Start network request in background
            startGameGeneration(gameState.theme);
            
            // Start the clock
            setInterval(() => {
                const now = new Date();
                const timeString = now.toISOString().split('T')[1].split('.')[0];
                document.getElementById('clock').innerText = timeString;
            }, 1000);

            // Print the prompt introduction
            setTimeout(() => {
                const introText = `
                    <h3>Welcome to <strong>The Aurora Protocol</strong></h3>
                    <p>I will act as your Game Master (GM), narrating the story, rolling the dice for you, and tracking your status.</p>
                    <br>
                    <h3>üìú How to Play</h3>
                    <ul>
                        <li><strong>Read the Scene:</strong> I will describe the situation.</li>
                        <li><strong>Make a Choice:</strong> Choose an option or suggest a custom action.</li>
                        <li><strong>The Roll:</strong> I simulate D20 + Stat.</li>
                        <li><strong>Consequences:</strong> Success advances story; failure causes harm.</li>
                    </ul>
                    <br>
                    <h3>‚öôÔ∏è Difficulty Levels</h3>
                    <ul>
                        <li><strong>A. Story Mode:</strong> +3 to rolls. Narrative focus.</li>
                        <li><strong>B. Explorer (Normal):</strong> No modifiers. Fair.</li>
                        <li><strong>C. Survivalist (Hard):</strong> -3 to rolls. High lethality.</li>
                    </ul>
                    <hr style="border-color: #333; margin: 10px 0;">
                    <p>To begin, please reply with your <strong>Difficulty Choice</strong> and <strong>Character Details</strong> (Name, Background, Goal, Flaw).</p>
                `;
                addMessage('gm', introText);
            }, 1000);
        }

        // Chat Interface Logic
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');

        function addMessage(sender, htmlContent) {
            const div = document.createElement('div');
            div.classList.add('message', sender);
            
            if (sender === 'gm') {
                div.innerHTML = `<div class="gm-content">${htmlContent}</div>`;
            } else {
                div.innerHTML = htmlContent;
            }
            
            chatBox.appendChild(div);
            // Ensure scroll happens after DOM update
            requestAnimationFrame(() => {
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }

        function sendMessage() {
            const text = userInput.value.trim();
            if (text === "") return;

            // User message
            addMessage('player', text);
            userInput.value = "";

            // Simulate GM Processing
            simulateGMResponse(text);
        }

        // Handle Enter key
        userInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        });

        // Mock logic for demo interactivity
        function simulateGMResponse(playerText) {
            // Delay to simulate thinking
            setTimeout(() => {
                const lowerText = playerText.toLowerCase();
                
                // Parsing for character creation to update UI stats
                if (lowerText.includes("veteran") || lowerText.includes("alpinist")) {
                    updateStats(2, 0, -1);
                    addMessage('gm', "<strong>Character Registered:</strong> The Veteran Alpinist. Your GRIT is high. The cold is familiar to you.<br><br>You stand on the deck of the icebreaker <em>HMS Erebus II</em>. The air is -40¬∞C. The Aurora pulsates above like a heartbeat. <br><br><strong>What do you do?</strong><br>1. Check the cargo hold.<br>2. Speak to the captain.<br>3. Inspect the weird magnetic readings.");
                } 
                else if (lowerText.includes("professor") || lowerText.includes("oxford")) {
                    updateStats(-1, 2, 0);
                    addMessage('gm', "<strong>Character Registered:</strong> The Oxford Professor. Your WITS are sharp. You see patterns others miss.<br><br>You stand on the deck. The equipment is going haywire.<br><br><strong>What do you do?</strong><br>1. Recalibrate the sensors.<br>2. Interview the crew about hallucinations.<br>3. Sketch the Aurora patterns.");
                }
                else if (lowerText.includes("dreamer")) {
                    updateStats(-1, 0, 2);
                    addMessage('gm', "<strong>Character Registered:</strong> The Dreamer. Your SPIRIT is unbreakable. You feel a presence here.<br><br>The wind whispers your name. <br><br><strong>What do you do?</strong><br>1. Follow the whisper.<br>2. Try to boost crew morale.<br>3. Look for signs of the workshop.");
                }
                else {
                    // Generic response
                    addMessage('gm', "The wind howls, drowning out your voice. The Aurora Protocol continues... (Please choose an option or describe your action).");
                }
            }, 800);
        }

        function updateStats(grit, wits, spirit) {
            gameState.stats.grit = grit;
            gameState.stats.wits = wits;
            gameState.stats.spirit = spirit;
            
            document.getElementById('grit-val').innerText = (grit >= 0 ? "+" : "") + grit;
            document.getElementById('wits-val').innerText = (wits >= 0 ? "+" : "") + wits;
            document.getElementById('spirit-val').innerText = (spirit >= 0 ? "+" : "") + spirit;
        }

        // Update Warmth visualizer
        function updateWarmth(val) {
            gameState.stats.warmth = val;
            const fill = document.getElementById('warmth-fill');
            const text = document.getElementById('warmth-text');
            
            fill.style.width = val + "%";
            text.innerText = val + "%";

            if (val < 30) {
                fill.style.background = "#ff0000";
                fill.style.boxShadow = "0 0 10px #ff0000";
            } else {
                fill.style.background = "linear-gradient(90deg, #ff3333, #ff9933, #ffffcc)";
                fill.style.boxShadow = "none";
            }
        }
    </script>
</body>
</html>